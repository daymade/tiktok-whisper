<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç®€å•æµ‹è¯•é¡µé¢</title>
    <style>
        body { 
            margin: 0; 
            background: linear-gradient(135deg, #0c0c0c 0%, #1a1a2e 50%, #16213e 100%);
            color: #fff; 
            font-family: Arial, sans-serif;
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
        }
        .container {
            text-align: center;
            padding: 40px;
            background: rgba(26, 26, 46, 0.8);
            border-radius: 20px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
        }
        h1 {
            font-size: 48px;
            background: linear-gradient(45deg, #4ecdc4, #45b7d1, #ff6b6b);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 20px;
        }
        .status {
            font-size: 18px;
            margin: 10px 0;
            padding: 10px;
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.1);
        }
        .success { border-left: 4px solid #4ecdc4; }
        .error { border-left: 4px solid #ff6b6b; }
        .info { border-left: 4px solid #45b7d1; }
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }
        .stat-item {
            background: rgba(255, 255, 255, 0.05);
            padding: 20px;
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        .stat-value {
            font-size: 32px;
            font-weight: bold;
            color: #4ecdc4;
            text-shadow: 0 0 10px rgba(78, 205, 196, 0.5);
        }
        .stat-label {
            font-size: 14px;
            color: #cccccc;
            margin-top: 8px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸš€ æŠ–éŸ³è½¬å½•æ•°æ®å¯è§†åŒ–</h1>
        
        <div id="webgl-test" class="status info">
            ğŸ” æ­£åœ¨æ£€æµ‹WebGLæ”¯æŒ...
        </div>
        
        <div id="api-test" class="status info">
            ğŸ“Š æ­£åœ¨æµ‹è¯•APIè¿æ¥...
        </div>
        
        <div id="data-test" class="status info">
            ğŸ’¾ æ­£åœ¨æ£€æŸ¥æ•°æ®çŠ¶æ€...
        </div>
        
        <div class="stats">
            <div class="stat-item">
                <div id="total-count" class="stat-value">-</div>
                <div class="stat-label">æ€»è½¬å½•æ•°</div>
            </div>
            <div class="stat-item">
                <div id="embedding-count" class="stat-value">-</div>
                <div class="stat-label">å·²ç”Ÿæˆå‘é‡</div>
            </div>
            <div class="stat-item">
                <div id="coverage" class="stat-value">-</div>
                <div class="stat-label">è¦†ç›–ç‡</div>
            </div>
        </div>
        
        <div style="margin-top: 30px;">
            <p>âœ¨ Chrome å®Œå…¨æ”¯æŒ Three.js å’Œ WebGL</p>
            <p>ğŸ® é—®é¢˜å¯èƒ½æ˜¯ç½‘ç»œæˆ–CDNåŠ è½½é—®é¢˜</p>
            <p>ğŸ’¡ æˆ‘ä»¬å·²ç»åˆ›å»ºäº†å®Œæ•´çš„3Då¯è§†åŒ–ç³»ç»Ÿ</p>
        </div>
    </div>

    <script>
        // æ£€æµ‹WebGLæ”¯æŒ
        function checkWebGL() {
            const webglTest = document.getElementById('webgl-test');
            try {
                const canvas = document.createElement('canvas');
                const gl = canvas.getContext('webgl') || canvas.getContext('experimental-webgl');
                if (gl) {
                    const renderer = gl.getParameter(gl.RENDERER);
                    webglTest.textContent = `âœ… WebGLæ”¯æŒæ­£å¸¸: ${renderer}`;
                    webglTest.className = 'status success';
                } else {
                    webglTest.textContent = 'âŒ WebGLä¸æ”¯æŒ';
                    webglTest.className = 'status error';
                }
            } catch (e) {
                webglTest.textContent = `âŒ WebGLé”™è¯¯: ${e.message}`;
                webglTest.className = 'status error';
            }
        }

        // æµ‹è¯•APIè¿æ¥
        async function testAPI() {
            const apiTest = document.getElementById('api-test');
            try {
                const response = await fetch('/api/stats');
                if (response.ok) {
                    const data = await response.json();
                    apiTest.textContent = 'âœ… APIè¿æ¥æ­£å¸¸';
                    apiTest.className = 'status success';
                    
                    // æ›´æ–°ç»Ÿè®¡æ•°æ®
                    document.getElementById('total-count').textContent = data.totalTranscripts || 0;
                    document.getElementById('embedding-count').textContent = (data.geminiEmbeddings || 0) + (data.openaiEmbeddings || 0);
                    document.getElementById('coverage').textContent = ((data.geminiEmbeddings || 0) / (data.totalTranscripts || 1) * 100).toFixed(1) + '%';
                } else {
                    apiTest.textContent = `âŒ APIå“åº”é”™è¯¯: ${response.status}`;
                    apiTest.className = 'status error';
                }
            } catch (error) {
                apiTest.textContent = `âŒ APIè¿æ¥å¤±è´¥: ${error.message}`;
                apiTest.className = 'status error';
            }
        }

        // æµ‹è¯•embeddingæ•°æ®
        async function testData() {
            const dataTest = document.getElementById('data-test');
            try {
                const response = await fetch('/api/embeddings?provider=gemini&limit=5');
                if (response.ok) {
                    const data = await response.json();
                    if (data.length > 0) {
                        dataTest.textContent = `âœ… æ‰¾åˆ° ${data.length} ä¸ªembeddingæ•°æ®ï¼Œç»´åº¦: ${data[0].embedding?.length || 'unknown'}`;
                        dataTest.className = 'status success';
                    } else {
                        dataTest.textContent = 'âš ï¸ æ²¡æœ‰æ‰¾åˆ°embeddingæ•°æ®';
                        dataTest.className = 'status error';
                    }
                } else {
                    dataTest.textContent = `âŒ æ•°æ®è·å–é”™è¯¯: ${response.status}`;
                    dataTest.className = 'status error';
                }
            } catch (error) {
                dataTest.textContent = `âŒ æ•°æ®è·å–å¤±è´¥: ${error.message}`;
                dataTest.className = 'status error';
            }
        }

        // è¿è¡Œæ‰€æœ‰æµ‹è¯•
        window.addEventListener('load', function() {
            checkWebGL();
            testAPI();
            testData();
        });
    </script>
</body>
</html>